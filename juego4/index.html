<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TEST1</title>
    <style>
        body { margin: 0; background: #000; font-family: sans-serif; overflow: hidden; }
        #video-container { width: 100vw; height: 100vh; position: relative; }
        
       video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center bottom; /* Muestra la parte superior del video y corta la de abajo */
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
}

        #interactive-layer { 
            display: none; position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%; z-index: 100; 
        }

        /* Contenedor de las estatuas visuales */
        .items-grid { 
            position: absolute;
            bottom: 30%; left: 8%; right: 10%; height: 60%;
            display: flex; justify-content: space-around; align-items: flex-end;
        }

        .item { 
            width: 22%; height: 80%; cursor: pointer;
            position: relative; transition: transform 0.3s ease;
            display: flex; align-items: center; justify-content: center;
        }

        /* La imagen real de la estatua */
        .item img {
            width: 95%; height: auto;
            pointer-events: none; /* Para que el clic pase al div padre */
        }

        .item.selected { 
            filter: brightness(1.5) drop-shadow(0 0 10px gold);
        }

        #confirm { 
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            padding: 15px 40px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="video-container">
   <video id="videoA" preload="auto" playsinline webkit-playsinline style="z-index: -1; width: 100%; height: 100%; object-fit: cover;">
    <source src="https://www.dropbox.com/scl/fi/du9ggb9ud58y5m71zf47m/Story.mp4?rlkey=c1vlvjrdnwq7hs04ro2w6bc9y&st=bu6ba7qq&raw=1" type="video/mp4">
</video>
        <video id="videoB" preload="auto" style="z-index: 5; opacity: 0;"></video>
        
        <div id="interactive-layer">
            <div class="items-grid" id="grid">
                <div class="item" data-id="A">
    <img src="https://lh3.googleusercontent.com/u/0/d/1Mbsh8SoDiP6HkVPqYmIcLjyUBqyBDsYg" alt="Toro">
</div>
       <div class="item" data-id="B">
    <img src="https://lh3.googleusercontent.com/u/0/d/1NubHKJ7cAUOqUTQfYww3CumfcRtBVErE" alt="Rey">
</div>

<div class="item" data-id="C">
    <img src="https://lh3.googleusercontent.com/u/0/d/1tlgMnQPPvWhpUw7mECDP5iC_YpgSJKUG" alt="Guerrero">
</div>

<div class="item" data-id="D">
    <img src="https://lh3.googleusercontent.com/u/0/d/1N4TPvfcT3pzAy33K7JoU8gmSMNJDTBn7" alt="Mujer">
</div>
            
                <button id="confirm">CONFIRMAR POSICIÓN</button>
        </div>
    </div>

    <script>
        const vA = document.getElementById('videoA');
        const vB = document.getElementById('videoB');
        const layer = document.getElementById('interactive-layer');
        const grid = document.getElementById('grid');
        
        let selectedItem = null;

        window.addEventListener('click', () => { if (vA.paused) vA.play(); }, { once: true });

        vA.onended = () => { layer.style.display = 'block'; };

        grid.addEventListener('click', (e) => {
            const target = e.target.closest('.item');
            if (!target) return;

            if (!selectedItem) {
                selectedItem = target;
                target.classList.add('selected');
            } else {
                // INTERCAMBIO VISUAL REAL (HTML Y DATOS)
                intercambiarElementos(selectedItem, target);
                selectedItem.classList.remove('selected');
                selectedItem = null;
            }
        });

        function intercambiarElementos(el1, el2) {
            // Intercambiamos el contenido (la imagen) y el ID
            const content1 = el1.innerHTML;
            const id1 = el1.dataset.id;

            el1.innerHTML = el2.innerHTML;
            el1.dataset.id = el2.dataset.id;

            el2.innerHTML = content1;
            el2.dataset.id = id1;
        }

       document.getElementById('confirm').onclick = () => {
    const resultadoFinal = grid.children[0].dataset.id;
    
    // 1. CONGELAR: Bloqueamos la interfaz pero no la borramos aún
    document.getElementById('confirm').style.display = 'none'; // Solo ocultamos el botón
    layer.style.pointerEvents = 'none'; // Evitamos que sigan tocando las estatuas
    
    // El video actual se queda pausado donde esté, sirviendo de fondo
    vA.pause(); 
    
    lanzarResultado(resultadoFinal);
};

function lanzarResultado(id) {
    let videoUrl = "";
    if(id === 'A') videoUrl = 'https://www.dropbox.com/scl/fi/ak1at3pdw6bt65az6x08r/Bull.mp4?rlkey=kz9cvk8ms35b0waszuhst80ko&st=znstodz0&raw=1';
    if(id === 'B') videoUrl = 'https://www.dropbox.com/scl/fi/de0cnr3cppggr9jmynman/Harold.mp4?rlkey=d9o0gmt9in0bv89i1e4mlde4a&st=mucwt286&raw=1';
    if(id === 'C') videoUrl = 'https://www.dropbox.com/scl/fi/1pyk6h5k0eyrhbpz78bbc/Wilhelm.mp4?rlkey=qc3s25q8mj2t73p2ga7co8fhm&st=32o6lv0a&raw=1';
    if(id === 'D') videoUrl = 'https://www.dropbox.com/scl/fi/gily8mgftrg9g6382yui1/Celestine.mp4?rlkey=ux7d7hhbegxj7rqtcfky1nq9w&st=q5pwpxhm&raw=1';

  // 2. PREPARAR vB (Vídeo 2)
    vB.src = videoUrl;
    vB.style.opacity = 0; 
    vB.load();

    vB.oncanplaythrough = () => {
        // 3. CAMBIO AL VÍDEO 2
        layer.style.display = 'none'; 
        vB.style.opacity = 1; 
        vB.style.zIndex = 20;
        vB.play();

        // --- LA MEJORA AQUÍ: PRECARGA DEL VÍDEO 3 ---
        // Empezamos a cargar el vídeo final ahora mismo, mientras el usuario ve el vídeo 2
        vA.src = 'https://www.dropbox.com/scl/fi/0wlutwufp86vlhywr7wcm/Final.mp4?rlkey=einmkqqd52f64kv13w9cgs3hv&st=umyosuox&raw=1';
        vA.load(); 
    };

    // 4. EMPALME AL INSTANTE
    vB.onended = () => {
        // Como vA ya se cargó durante la reproducción de vB, el cambio es inmediato
        vA.style.zIndex = 40;
        vA.style.opacity = 1; 
        
        vB.pause(); 
        vA.play();

        // Limpieza final
        layer.remove(); 
    };
            };
          </script>
</body>
</html>
